<!DOCTYPE html>


<html lang="en">
  

    <head>
      <meta charset="utf-8" />
        
      <meta name="description" content="本站并非用于教学或商业目的，仅仅用于记录和分享个人在学习和工作中遇到技术问题" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>Comparator的奇怪报错 |  Cirno的笔记本</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
      />
      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
       
 

      <!-- mermaid -->
      
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-Comparator"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  Comparator的奇怪报错
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/05/23/Comparator/" class="article-date">
  <time datetime="2021-05-23T12:39:07.000Z" itemprop="datePublished">2021-05-23</time>
</a>   
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> Word count:</span>
            <span class="post-count">4k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> Reading time≈</span>
            <span class="post-count">20 min</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <p>今天在写leetcode1738时，习以为常的使用了老朋友Arrays.sort()来实现降序排序：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Arrays.sort(arr, (o1, o2) -&gt; o1 &gt; o2 ? -<span class="number">1</span> : <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>提交后发现有一个用例报了如下错误：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalArgumentException: Comparison method violates its general contract!</span><br><span class="line">  at line <span class="number">781</span>, java.base/java.util.TimSort.mergeLo</span><br><span class="line">  at line <span class="number">518</span>, java.base/java.util.TimSort.mergeAt</span><br><span class="line">  at line <span class="number">461</span>, java.base/java.util.TimSort.mergeForceCollapse</span><br><span class="line">  at line <span class="number">254</span>, java.base/java.util.TimSort.sort</span><br><span class="line">  at line <span class="number">1442</span>, java.base/java.util.Arrays.sort</span><br><span class="line">  at line <span class="number">33</span>, Solution.kthLargestValue</span><br><span class="line">  at line <span class="number">54</span>, __DriverSolution__.__helper__</span><br><span class="line">  at line <span class="number">87</span>, __Driver__.main</span><br></pre></td></tr></table></figure>

<p>不难看出，是代码中的Comparator出了问题，如果o1 == o2，理应返回0，但按照代码中的逻辑，o1 == o2 时会返回1，当然会报错。但是，上述的报错并不会像我们想象的一样100%出现，有时只会在特定的数据集上出现，有时甚至会被不经意的避免掉，下面我们来复现一下这个报错：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Integer[] arr = <span class="keyword">new</span> Integer[]&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">13</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">0</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">13</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">6</span>&#125;;</span><br><span class="line"></span><br><span class="line">Arrays.sort(arr, (o1, o2) -&gt; o1 &gt; o2 ? -<span class="number">1</span> : <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>上方的代码一定会出现 <code>Comparison method violates its general contract!</code>报错，但是假如我们改动一下数据的顺序，比如像下面这样，先正序排列一下，然后再倒序排列，错误就会消失：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Integer[] arr = <span class="keyword">new</span> Integer[]&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">13</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">0</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">13</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">6</span>&#125;;</span><br><span class="line">Arrays.sort(arr);</span><br><span class="line">Arrays.sort(arr, (o1, o2) -&gt; o1 &gt; o2 ? -<span class="number">1</span> : <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>虽然我们成功的让报错消失了，但这似乎是一件很恐怖的事，因为我们明知道这个Comparator本身是存在bug的，却没报错，这就像是一个小的定时炸弹，会在我们不经意的时候悄悄炸掉。这么一想，在一开始就出现了 <code>Comparison method violates its general contract!</code>报错反而才是最好的情况。这就告诉我们在编写自定义Comparator时一定要仔细，不可漏掉存在的可能性。</p>
<p>我在查阅资料时，在YouTube上看到了一个关于这个主题不错的视频，是来自Oracle的Stuark Marks的公开课，他在JDK Group的Core Libraries Team工作，他在Java 的Comparator肯定是很有发言权的了。本文是对Stuark Marks的演讲做一个总结概括，这是一个很有趣的公开课，比如他在视频中提到：“<code>Comparison method violates its general contract!</code>这个报错信息据我所知是唯一一个在末尾用了感叹号的Exception信息，当时写这个的人一定激动坏了。” 我会把原视频的链接放在本文末尾，感兴趣的朋友可以去看一下。</p>
<h2 id="Comparator必须遵循的Rules"><a href="#Comparator必须遵循的Rules" class="headerlink" title="Comparator必须遵循的Rules"></a>Comparator必须遵循的Rules</h2><blockquote>
<p>A comparison function, which imposes a <em>total ordering</em> on some collection of objects. Comparators can be passed to a sort method (such as <a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/util/Collections.html#sort(java.util.List,java.util.Comparator)"><code>Collections.sort</code></a> or <a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/util/Arrays.html#sort(T[],java.util.Comparator)"><code>Arrays.sort</code></a>) to allow precise control over the sort order. Comparators can also be used to control the order of certain data structures (such as <a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/util/SortedSet.html"><code>sorted sets</code></a> or <a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/util/SortedMap.html"><code>sorted maps</code></a>), or to provide an ordering for collections of objects that don’t have a <a target="_blank" rel="noopener" href="https://docs.oracle.com/en/java/javase/15/docs/api/java.base/java/lang/Comparable.html"><code>natural ordering</code></a>.</p>
</blockquote>
<p>上述的jdk文档中提到了<strong>全序排列（Total Ordering）</strong>。首先对于任意的a和b，都应满足<strong>三分率（Law of Trichotomy）</strong>：即a和b满足其中一种关系：a &lt; b , a =b, a &gt; b。</p>
<p>数学中如果一个集合满足了全序关系，那么下列陈述对集合中的元素都成立：</p>
<ul>
<li>传递性（Transitivity）：a &lt; b 和 b &lt; c 可以推出 a &lt; c</li>
<li>反对称性（Antisymmetry）：a &lt; b 可以推出 ~b &lt; a</li>
<li>可代换性（Substitutability）：a == b 和 a &lt; c 可以推出 b &lt; c</li>
<li>自反性（Reflexivity）：  如果a == a，那么~a &lt; a</li>
</ul>
<p>同样的，在Java中，Interface Comparator<T>也呈现了这种全序关系，它包含了一个方法 <code>int compare(T a, T b)</code>。</p>
<p>返回值的三分率：</p>
<ul>
<li>compare(a, b) &lt; 0：a &lt; b</li>
<li>compare(a, b) == 0：a == b</li>
<li>compare(a, b) &gt; 0：a &gt; b</li>
</ul>
<p>返回值必须一致：</p>
<ul>
<li>给定a和b，多次调用compare(a, b)必须返回相同的值。</li>
</ul>
<h2 id="Demo1——Overflow！"><a href="#Demo1——Overflow！" class="headerlink" title="Demo1——Overflow！"></a>Demo1——Overflow！</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.util.stream.Collectors.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo1</span></span>&#123;	</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Comparator&lt;Integer&gt; <span class="title">logging</span><span class="params">(Comparator&lt;Integer&gt; c)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (a,b) -&gt;&#123;</span><br><span class="line">			<span class="keyword">int</span> r = c.compare(a,b);</span><br><span class="line">			System.err.printf(<span class="string">&quot;%,14d  %,14d,=&gt; %,14d \n&quot;</span>, a,b,r);</span><br><span class="line">			<span class="keyword">return</span> r;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// Generates a list of 32 random integers. </span></span><br><span class="line">		List&lt;Integer&gt; list = <span class="keyword">new</span> Random(<span class="number">209</span>).ints(<span class="number">32L</span>).boxed().collect(toCollection(ArrayList::<span class="keyword">new</span>));</span><br><span class="line">		list.sort((a, b) -&gt; a - b);</span><br><span class="line">		System.out.println(list);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行上述代码会抛出<code>Comparison method violates its general contract!</code>这个异常，我们很难单从异常信息中分析出问题所在，不妨使用<code>logging()</code>函数来打印一下sort函数调用Comparator的过程。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list.sort(logging((a, b) -&gt; a - b));</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Output：   </span><br><span class="line">-1,812,923,685  -1,125,089,413,=&gt;   -687,834,272 //a &lt; b, result &lt; 0</span><br><span class="line">  -659,152,435  -1,812,923,685,=&gt;  1,153,771,250 //a &gt; b, result &gt; 0</span><br><span class="line">  -659,152,435  -1,125,089,413,=&gt;    465,936,978 //a &lt; b, result &gt; 0</span><br><span class="line"> 1,373,845,359  -1,125,089,413,=&gt; -1,796,032,524 //a &gt; b, result &lt; 0 (x)</span><br><span class="line"> 1,373,845,359  -1,812,923,685,=&gt; -1,108,198,252 //a &gt; b, result &lt; 0 (x)</span><br><span class="line"> ... ...</span><br></pre></td></tr></table></figure>

<p>从第四行、第五行我们可以发现，返回值出了问题，应该返回正数才对，却变成了负数。结合我们Comparator写法，我们发现是a - b导致了Integer Overflow。</p>
<h2 id="Demo2——小心“-”"><a href="#Demo2——小心“-”" class="headerlink" title="Demo2——小心“==”"></a>Demo2——小心“==”</h2><p>让我们换一种写法，不用导致溢出的加减法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> Random(<span class="number">2664</span>).ints(<span class="number">32l</span>, <span class="number">1080</span>, <span class="number">1280</span>).boxed().collect(toCollection(ArrayList::<span class="keyword">new</span>)); </span><br><span class="line">list.sort(logging((a, b) -&gt; a &lt; b ? -<span class="number">1</span> : a == b? <span class="number">0</span> : <span class="number">1</span>));</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Output：   </span><br><span class="line">1,093           1,091,=&gt;              1 </span><br><span class="line">1,104           1,093,=&gt;              1 </span><br><span class="line">1,104           1,104,=&gt;              1 //应该是0才对</span><br><span class="line">1,115           1,104,=&gt;              1 </span><br><span class="line">... ...</span><br></pre></td></tr></table></figure>

<p>1104 和 1104是相等的，但返回值却不是0。原因其实就是Integer的自动拆箱，==是<em>Reference Equality</em>，在-128 ~ 127之间，使用的是相同的地址，而超出这个范围，地址便不同了，所以在Comparator中使用==是不正确的。</p>
<h3 id="可行的写法"><a href="#可行的写法" class="headerlink" title="可行的写法"></a>可行的写法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">list.sort((a, b) -&gt; a &lt; b ? -<span class="number">1</span> : a &gt; b? <span class="number">1</span> : <span class="number">0</span>);<span class="comment">//替换位置</span></span><br><span class="line">list.sort(Integer::compare);</span><br><span class="line">list.sort(<span class="keyword">null</span>);<span class="comment">//null means &quot;natural order&quot;</span></span><br><span class="line">list.sort(Comparator.naturalOrder());</span><br></pre></td></tr></table></figure>

<h2 id="Demo3——奇怪的NaN值"><a href="#Demo3——奇怪的NaN值" class="headerlink" title="Demo3——奇怪的NaN值"></a>Demo3——奇怪的NaN值</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo3</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Comparator&lt;Double&gt; <span class="title">logging</span><span class="params">(Comparator&lt;Double&gt; c)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (a,b) -&gt;&#123;</span><br><span class="line">			<span class="keyword">int</span> r = c.compare(a,b);</span><br><span class="line">			System.err.printf(<span class="string">&quot;%7.1f  %7.1f   =&gt;   %2d \n&quot;</span>, a,b,r);</span><br><span class="line">			<span class="keyword">return</span> r;</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		List&lt;Double&gt; list = <span class="keyword">new</span> Random(<span class="number">284397476</span>).ints(<span class="number">100L</span>).map(Math::abs).mapToDouble(i -&gt; Math.sqrt((<span class="keyword">double</span>)i)).boxed().collect(toCollection(ArrayList::<span class="keyword">new</span>)); </span><br><span class="line">		list.sort(logging((a, b) -&gt; a &lt; b ? -<span class="number">1</span> : a &gt; b? <span class="number">1</span> : <span class="number">0</span>));</span><br><span class="line">		System.out.println(list);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们尝试把集合改成Double类型，异常又出现了，我们再次使用<code>logging</code>函数来查看过程中的值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Output：   </span><br><span class="line">41443.6  40478.5   =&gt;    1 </span><br><span class="line">40478.5  40719.4   =&gt;   -1 </span><br><span class="line">40478.5  40133.5   =&gt;    1 </span><br><span class="line">40133.5      NaN   =&gt;    0 </span><br><span class="line">39406.4      NaN   =&gt;    0 </span><br><span class="line">    NaN  32425.0   =&gt;    0 </span><br><span class="line">    NaN  31205.7   =&gt;    0 </span><br><span class="line">    ... </span><br></pre></td></tr></table></figure>

<p>原来是集合中出现了NaN值，NaN是不服从三分率的一个特殊存在，用100和NaN为例，下面这几个陈述对于NaN来说，都是不成立的：</p>
<ul>
<li>100 &lt; NaN</li>
<li>100 &gt; NaN</li>
<li>100 == NaN</li>
<li>NaN == NaN</li>
</ul>
<h3 id="可行的写法-1"><a href="#可行的写法-1" class="headerlink" title="可行的写法"></a>可行的写法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用isNaN()来判断特殊情况</span></span><br><span class="line"><span class="keyword">if</span>(d.isNaN())&#123;...&#125;</span><br><span class="line"><span class="comment">//会把NaN当成最大的值</span></span><br><span class="line">list.sort(Double::compare);</span><br><span class="line">list.sort(<span class="keyword">null</span>);</span><br><span class="line">list.sort(Comparator.naturalOrder());</span><br></pre></td></tr></table></figure>

<h2 id="自定义对象的排序"><a href="#自定义对象的排序" class="headerlink" title="自定义对象的排序"></a>自定义对象的排序</h2><p>上面几个例子可以看出，即便是对简单的数据类型来构建自定义的Comparator，也会因粗心而出现漏洞。Java 8之后，允许接口提供默认的静态方法，Comparator也提供很多这样的方法，组合使用这些方法来构建Comparator，往往可以避免自己造轮子时的漏洞，代码的简洁性和可读性也会更好一些。下面的部分会尝试使用组合方法来构建Comparator，并排序自定义的Java对象。</p>
<h2 id="Comparator的静态方法"><a href="#Comparator的静态方法" class="headerlink" title="Comparator的静态方法"></a>Comparator的静态方法</h2><p>在Comparator接口中的静态方法主要有两个作用：构建Comparator 和 减少自定义的逻辑代码。</p>
<ul>
<li>comparing(keyExtractor), also -Int, -Long, -Double </li>
<li>reversed() </li>
<li>thenComparing(keyExtractor), also -Int, -Long, -Double  </li>
<li>nullsFirst(comparator), </li>
<li>nullsLast(comparator) </li>
<li>naturalOrder(), reverseOrder() </li>
</ul>
<h2 id="构建简单的Comparator"><a href="#构建简单的Comparator" class="headerlink" title="构建简单的Comparator"></a>构建简单的Comparator</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Player Class</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Player</span> </span>&#123; </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDisplayName</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> displayName;&#125; </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getNickname</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> nickname;&#125; <span class="comment">// can return null </span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getGamesPlayed</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> gamesPlayed;&#125; </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getRating</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> rating;&#125; </span><br><span class="line">    <span class="comment">//... ...</span></span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.util.Comparator.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">//List of Player Objects</span></span><br><span class="line">List&lt;Player&gt; playerList = Arrays.asList(</span><br><span class="line">    ... ...</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// sort by display name, long form  </span></span><br><span class="line">playerList.sort((a, b) -&gt; a.getDisplayName().compareTo(b.getDisplayName()));</span><br><span class="line"><span class="comment">// sort by display name, shorter </span></span><br><span class="line">playerList.sort(comparing(Player::getDisplayName));</span><br><span class="line"><span class="comment">// sort by display name, reversed</span></span><br><span class="line">playerList.sort(comparing(Player::getDisplayName).reversed()); </span><br><span class="line"><span class="comment">// sort by games played</span></span><br><span class="line">playerList.sort(comparingInt(Player::getGamesPlayed)); </span><br><span class="line"><span class="comment">// sort by player rating</span></span><br><span class="line">playerList.sort(comparingDouble(Player::getRating).reversed()); </span><br></pre></td></tr></table></figure>

<h2 id="包含Null的特殊情况"><a href="#包含Null的特殊情况" class="headerlink" title="包含Null的特殊情况"></a>包含Null的特殊情况</h2><p>上面是几种简单的情景，分别对<code>playList</code>进行了排序，下面我们再看几个稍微复杂一点的例子。注意，我们Player的NickName是可以为null的，所以直接使用<code>comparing(Player::getNickname)</code>会报null pointer异常，这就需要用到 <code>nullsFirst(comparator)</code>或者 <code>nullsLast(comparator)</code> 了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">playerList.sort(comparing(Player::getNickname, nullsFirst(naturalOrder())));</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Output：         </span><br><span class="line">         Dispaly Name    Nickname  	 #GA      Rate</span><br><span class="line"> ---------------------    --------       ---      ----         </span><br><span class="line">[      Hertha Halligan        null        59      0.12</span><br><span class="line">,          Eun Atwater        null        33      0.39</span><br><span class="line">,     Elfriede Allison        null        89      0.72</span><br><span class="line">,    Katheleen Leclerc        null        12      0.73</span><br><span class="line">,            Pura Rowe        null         9      0.74</span><br><span class="line">,     Marquita Lockamy        null        77      0.61</span><br><span class="line">,         Thalia Pilon        null        20      0.62</span><br><span class="line">,    France Funderburg        null        50      0.63</span><br><span class="line">,     Albertina Bounds        null        11      0.73</span><br><span class="line">,         Sonya Rainer        null        15      0.60</span><br><span class="line">,       Lakeisha Leeks        null        26      0.55</span><br><span class="line">,           Mose Wells        null        34      0.58</span><br><span class="line">,    Bernarda Jefferys        null        37      0.59</span><br><span class="line">,        Sherise Nuzzo     Blimpie        91      0.88</span><br><span class="line">,        Bobbye Kramer       Champ        34      0.44</span><br><span class="line">,      Katharine Lemos       Champ        88      0.33</span><br><span class="line">,         Valeri Polak       Champ        22      0.63</span><br><span class="line">,  Myron Schreckengost       Champ        98      0.64</span><br><span class="line">,          Milo Prunty       Chica        65      0.47</span><br><span class="line">,       Maryanna Arvin       Chili        58      0.57</span><br><span class="line">,          Vilma Erler      Cowboy        70      0.31</span><br><span class="line">,        Trish Cornman        Dino        21      0.63</span><br><span class="line">,         Velia Mccuin   Dragonfly        35      0.78</span><br><span class="line">,         Raisa Jahnke      Focker        33      0.18</span><br><span class="line">,         Artie Baylis  Goldilocks        50      0.45</span><br><span class="line">,            Ngan Hebb        Hulk        27      0.44</span><br><span class="line">,  Candelaria Rosinski       Kitty       123      0.53</span><br><span class="line">,     Kaitlyn Alberson        Nerd        21      0.38</span><br><span class="line">,        Marina Dahmen   Peppa Pig        13      0.12</span><br><span class="line">,       Melodie Vicini      Tarzan        36      0.66</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>注意我们的目标是解决Nickname为null的情况，因此下面这种是错误写法，因为这样就变成把Player为null的排在最前面了，因此，Nickname为null的情况还是不会被处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">playerList.sort(nullsFirst(comparing(Player::getNickname)));<span class="comment">//错误写法</span></span><br></pre></td></tr></table></figure>

<h2 id="二级排序"><a href="#二级排序" class="headerlink" title="二级排序"></a>二级排序</h2><p>上面我们已经按Nickname来给<code>playerList</code>排序了，如果我们想进一步对Nickname相同的Player进行二级排序，就要用到<code>thenComparing()</code>方法。下面我们对有相同Nickname的player，按DisplayName进行排序。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">playerList.sort(comparing(Player::getNickname, nullsFirst(naturalOrder()))<span class="comment">//先按Nickname升序</span></span><br><span class="line">                .thenComparing(Player::getDisplayName,reverseOrder()));<span class="comment">//Nickname一样的按Display Name降序</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Output：         </span><br><span class="line">         Dispaly Name    Nickname  	 #GA      Rate</span><br><span class="line"> ---------------------    --------       ---      ----  </span><br><span class="line">[         Thalia Pilon        null        20      0.62</span><br><span class="line">,         Sonya Rainer        null        15      0.60</span><br><span class="line">,            Pura Rowe        null         9      0.74</span><br><span class="line">,           Mose Wells        null        34      0.58</span><br><span class="line">,     Marquita Lockamy        null        77      0.61</span><br><span class="line">,       Lakeisha Leeks        null        26      0.55</span><br><span class="line">,    Katheleen Leclerc        null        12      0.73</span><br><span class="line">,      Hertha Halligan        null        59      0.12</span><br><span class="line">,    France Funderburg        null        50      0.63</span><br><span class="line">,          Eun Atwater        null        33      0.39</span><br><span class="line">,     Elfriede Allison        null        89      0.72</span><br><span class="line">,    Bernarda Jefferys        null        37      0.59</span><br><span class="line">,     Albertina Bounds        null        11      0.73</span><br><span class="line">,        Sherise Nuzzo     Blimpie        91      0.88</span><br><span class="line">,         Valeri Polak       Champ        22      0.63</span><br><span class="line">,  Myron Schreckengost       Champ        98      0.64</span><br><span class="line">,      Katharine Lemos       Champ        88      0.33</span><br><span class="line">,        Bobbye Kramer       Champ        34      0.44</span><br><span class="line">,          Milo Prunty       Chica        65      0.47</span><br><span class="line">,       Maryanna Arvin       Chili        58      0.57</span><br><span class="line">,          Vilma Erler      Cowboy        70      0.31</span><br><span class="line">,        Trish Cornman        Dino        21      0.63</span><br><span class="line">,         Velia Mccuin   Dragonfly        35      0.78</span><br><span class="line">,         Raisa Jahnke      Focker        33      0.18</span><br><span class="line">,         Artie Baylis  Goldilocks        50      0.45</span><br><span class="line">,            Ngan Hebb        Hulk        27      0.44</span><br><span class="line">,  Candelaria Rosinski       Kitty       123      0.53</span><br><span class="line">,     Kaitlyn Alberson        Nerd        21      0.38</span><br><span class="line">,        Marina Dahmen   Peppa Pig        13      0.12</span><br><span class="line">,       Melodie Vicini      Tarzan        36      0.66</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="与equals的一致性"><a href="#与equals的一致性" class="headerlink" title="与equals的一致性"></a>与equals的一致性</h2><p><code>compare(a, b) == 0</code> 和 <code>a.equals(b) == true</code>并不一定总是一致的，也并不是必须一致的。一些api比如BigDecimal也是有着这样的不一致性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BigDecimal a = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;1.00&quot;</span>);</span><br><span class="line">BigDecimal b = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;1.0000&quot;</span>);</span><br><span class="line">System.out.println(a.compareTo(b));<span class="comment">//0</span></span><br><span class="line">System.out.println(a.equals(b));<span class="comment">//false</span></span><br></pre></td></tr></table></figure>

<p>官方文档提到了这个不一致性有时会体现在 <code>Sorted Set</code> 或者 <code>Sorted Map</code>上，会让它们出现奇怪的行为：</p>
<blockquote>
<p>If the ordering imposed by <code>c</code> on <code>S</code> is inconsistent with equals, the sorted set (or sorted map) will behave “strangely.” In particular the sorted set (or sorted map) will violate the general contract for set (or map), which is defined in terms of <code>equals</code>.</p>
</blockquote>
<p>下面用一个例子来展示一下这种怪异的表现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">BigDecimal a = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;1.00&quot;</span>);</span><br><span class="line">BigDecimal b = <span class="keyword">new</span> BigDecimal(<span class="string">&quot;1.0000&quot;</span>);</span><br><span class="line">Set&lt;BigDecimal&gt; hs = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">Set&lt;BigDecimal&gt; ts = <span class="keyword">new</span> TreeSet&lt;&gt;();</span><br><span class="line">hs.add(a);</span><br><span class="line">ts.add(b);</span><br><span class="line">System.out.println(hs);<span class="comment">//[1.00]</span></span><br><span class="line">System.out.println(ts);<span class="comment">//[1.0000]</span></span><br><span class="line">System.out.println(hs.equals(ts));<span class="comment">//false</span></span><br><span class="line">System.out.println(ts.equals(hs));<span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<p>简单来说，在比较时，<code>TreeSet</code>是使用的Comparator来判断集合的每个元素是否相等，而<code>HashSet</code>就是使用的equals()。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在学校或者刷算法时我们往往已经习惯了造轮子，这对我们代码水平一定是有帮助的，但有时会给自己留下惯性思维，因为错误的Comparator也并不会百分百抛出异常，甚至在力扣上恰巧通过所有用例都是有可能的，比如博主在一开始提到的写法，直到今天我才遇到了抛出异常的情况。使用library routines来构建Comparator可以很大程度上避免小bug，而且会很大程度的缩减代码量，何乐而不为呢。</p>
<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Player Class</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Player</span> </span>&#123; </span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> String displayName;</span><br><span class="line">	<span class="keyword">private</span> String nickname;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> gamesPlayed;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> rating;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Player</span><span class="params">(String displayName, <span class="keyword">int</span> gamesPlayed, <span class="keyword">double</span> rating)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.displayName = displayName;</span><br><span class="line">		<span class="keyword">this</span>.gamesPlayed = gamesPlayed;</span><br><span class="line">		<span class="keyword">this</span>.rating = rating;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Player</span><span class="params">(String displayName, String nickName, <span class="keyword">int</span> gamesPlayed, <span class="keyword">double</span> rating)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.displayName = displayName;</span><br><span class="line">		<span class="keyword">this</span>.nickname = nickName;</span><br><span class="line">		<span class="keyword">this</span>.gamesPlayed = gamesPlayed;</span><br><span class="line">		<span class="keyword">this</span>.rating = rating;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDisplayName</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> displayName;&#125; </span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getNickname</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> nickname;&#125; <span class="comment">// can return null </span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getGamesPlayed</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> gamesPlayed;&#125; </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getRating</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> rating;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> String.format(<span class="string">&quot;%20s%12s%10d%10.2f\n&quot;</span>, displayName, nickname, gamesPlayed, rating);</span><br><span class="line">	&#125; </span><br><span class="line">    </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//Player数据初始化</span></span><br><span class="line">	List&lt;Player&gt; playerList = Arrays.asList(</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Artie Baylis&quot;</span>,<span class="string">&quot;Goldilocks&quot;</span> ,<span class="number">50</span> ,<span class="number">0.45d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Bobbye Kramer&quot;</span>,<span class="string">&quot;Champ&quot;</span> , <span class="number">34</span>,<span class="number">0.44d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Velia Mccuin&quot;</span>,<span class="string">&quot;Dragonfly&quot;</span> , <span class="number">35</span>,<span class="number">0.78d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Melodie Vicini&quot;</span>,<span class="string">&quot;Tarzan&quot;</span> , <span class="number">36</span>,<span class="number">0.66d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Katharine Lemos&quot;</span>,<span class="string">&quot;Champ&quot;</span> , <span class="number">88</span>,<span class="number">0.33d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Candelaria Rosinski&quot;</span>,<span class="string">&quot;Kitty&quot;</span> ,<span class="number">123</span> ,<span class="number">0.53d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Milo Prunty&quot;</span>,<span class="string">&quot;Chica&quot;</span> , <span class="number">65</span>,<span class="number">0.47d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Marina Dahmen&quot;</span>,<span class="string">&quot;Peppa Pig&quot;</span> , <span class="number">13</span>, <span class="number">0.12d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Vilma Erler&quot;</span>,<span class="string">&quot;Cowboy&quot;</span> , <span class="number">70</span>, <span class="number">0.31d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Kaitlyn Alberson&quot;</span>,<span class="string">&quot;Nerd&quot;</span> , <span class="number">21</span>, <span class="number">0.38d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Trish Cornman&quot;</span>,<span class="string">&quot;Dino&quot;</span> , <span class="number">21</span>,<span class="number">0.63d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Valeri Polak&quot;</span>,<span class="string">&quot;Champ&quot;</span> , <span class="number">22</span>, <span class="number">0.63d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Raisa Jahnke&quot;</span>,<span class="string">&quot;Focker&quot;</span> , <span class="number">33</span>, <span class="number">0.18d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Myron Schreckengost&quot;</span>,<span class="string">&quot;Champ&quot;</span> ,<span class="number">98</span> , <span class="number">0.64d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Maryanna Arvin&quot;</span>,<span class="string">&quot;Chili&quot;</span> , <span class="number">58</span>, <span class="number">0.57d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Sherise Nuzzo&quot;</span>,<span class="string">&quot;Blimpie&quot;</span> , <span class="number">91</span>, <span class="number">0.88d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Ngan Hebb&quot;</span>,<span class="string">&quot;Hulk&quot;</span> , <span class="number">27</span>, <span class="number">0.44d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Hertha Halligan&quot;</span>, <span class="number">59</span>, <span class="number">0.12d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Eun Atwater&quot;</span>, <span class="number">33</span>, <span class="number">0.39d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Elfriede Allison&quot;</span>, <span class="number">89</span>, <span class="number">0.72d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Katheleen Leclerc&quot;</span>, <span class="number">12</span>,<span class="number">0.73d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Pura Rowe&quot;</span>, <span class="number">9</span>, <span class="number">0.74d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Marquita Lockamy&quot;</span>,<span class="number">77</span> , <span class="number">0.61d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Thalia Pilon&quot;</span>,<span class="number">20</span> , <span class="number">0.62d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;France Funderburg&quot;</span>, <span class="number">50</span>, <span class="number">0.63d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Albertina Bounds&quot;</span>, <span class="number">11</span>, <span class="number">0.73d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Sonya Rainer&quot;</span>,<span class="number">15</span> , <span class="number">0.60d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Lakeisha Leeks&quot;</span>,<span class="number">26</span> , <span class="number">0.55d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Mose Wells&quot;</span>,<span class="number">34</span> , <span class="number">0.58d</span>),</span><br><span class="line">			<span class="keyword">new</span> Player(<span class="string">&quot;Bernarda Jefferys&quot;</span>,<span class="number">37</span> , <span class="number">0.59d</span>)</span><br><span class="line">			);</span><br><span class="line">       <span class="comment">// ... ...</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/util/Comparator.html">https://docs.oracle.com/javase/8/docs/api/java/util/Comparator.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=bvnmbRo7a1Y">https://www.youtube.com/watch?v=bvnmbRo7a1Y</a></p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=Enwbh6wpnYs&amp;t=1539s">https://www.youtube.com/watch?v=Enwbh6wpnYs&amp;t=1539s</a></p>
 
      <!-- reward -->
      
      <div id="reword-out">
        <div id="reward-btn">
          Donate
        </div>
      </div>
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>Copyright： </strong>
          
          Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://example.com/2021/05/23/Comparator/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Comparator/" rel="tag">Comparator</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
    
      <a href="/2021/05/23/hello-world/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">Hello World</div>
      </a>
    
  </nav>

   
<!-- valine评论 -->
<div id="vcomments-box">
  <div id="vcomments"></div>
</div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script>
<script>
  new Valine({
    el: "#vcomments",
    app_id: "",
    app_key: "",
    path: window.location.pathname,
    avatar: "monsterid",
    placeholder: "给我的文章加点评论吧~",
    recordIP: true,
  });
  const infoEle = document.querySelector("#vcomments .info");
  if (infoEle && infoEle.childNodes && infoEle.childNodes.length > 0) {
    infoEle.childNodes.forEach(function (item) {
      item.parentNode.removeChild(item);
    });
  }
</script>
<style>
  #vcomments-box {
    padding: 5px 30px;
  }

  @media screen and (max-width: 800px) {
    #vcomments-box {
      padding: 5px 0px;
    }
  }

  #vcomments-box #vcomments {
    background-color: #fff;
  }

  .v .vlist .vcard .vh {
    padding-right: 20px;
  }

  .v .vlist .vcard {
    padding-left: 10px;
  }
</style>

 
   
     
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2021
        <i class="ri-heart-fill heart_icon"></i> Wei Li
      </li>
    </ul>
    <ul>
      <li>
        
        
        
        Powered by <a href="https://hexo.io" target="_blank">Hexo</a>
        <span class="division">|</span>
        Theme - <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>Visitors:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>Views:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="Cirno的笔记本"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags/%E6%97%85%E8%A1%8C/">旅行</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="http://shenyu-vip.lofter.com">摄影</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2021/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
  </div>
</body>

</html>